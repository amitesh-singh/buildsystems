port code from code-share to here.
